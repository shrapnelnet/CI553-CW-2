name: "Deploy Javadoc"

on:
  push:
    paths:
      - "**.java"
      - ".github/workflows/javadoc.yml"
    branches:
      - "master"
  workflow_dispatch:

jobs:
  generate_javadoc:
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v4
        with:
          repository: shrapnelnet/CI553-CW-2
          ref: 'master'
          token: ${{ secrets.ACTIONS_GITHUB_TOKEN }}

      - name: setup git config
        run: |
          git config user.name "GitHub Actions Bot"
          git config user.email "<>"
          git remote add javadoc git@github.com:shrapnelnet/CI553-CW-2-Javadoc

      - name: Set-up Java and Maven
        uses: s4u/setup-maven-action@v1.18.0
        with:
          java-distribution: "adopt-hotspot"
          maven-version: '3.9.6'
          java-version: '21'

      - name: Generate JavaDoc
        run: mvn -q verify javadoc:javadoc

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: 'reports/apidocs'

      - name: Push to CI553-CW-2-Javadoc
        run: git push javadoc master

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
